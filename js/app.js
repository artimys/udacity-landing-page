const data = [
    {
        id: 1,
        link: "Section 1",
        title: "Section 1",
        content: `
            <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Illo molestiae ratione ipsum necessitatibus rerum, voluptatem obcaecati repellat praesentium ullam ad eveniet omnis voluptates itaque deserunt ducimus aliquam quasi incidunt quibusdam!</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum, cum quaerat facilis excepturi, rem numquam corrupti tempore quas beatae omnis suscipit doloribus aut dignissimos sit assumenda non voluptas cupiditate qui?
            Incidunt, ut reiciendis voluptate amet provident debitis numquam tenetur rem fugiat quod deserunt saepe earum assumenda ad, facere laudantium enim autem mollitia vero cum atque animi. Magnam dolorum soluta nobis?
            Omnis dicta aperiam, dolor iure atque consequatur eum cum quisquam autem deleniti voluptatum tempora architecto voluptate reprehenderit hic magnam aspernatur doloribus nesciunt vitae velit, ipsum natus incidunt modi tempore! Eos!  Laborum dolores nulla sed. Aperiam minima cum repellendus fugit nihil et iste iusto ipsam non mollitia obcaecati, sapiente minus voluptates rem magnam numquam sequi suscipit expedita nisi quod placeat molestiae!
            </p>`
    },
    {
        id: 2,
        link: "Section 2",
        title: "Section 2",
        content: `
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident quisquam sunt quis error odio voluptates non porro, veritatis reprehenderit numquam fugiat itaque. Velit libero earum architecto fugiat nemo, unde consequuntur.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum, cum quaerat facilis excepturi, rem numquam corrupti tempore quas beatae omnis suscipit doloribus aut dignissimos sit assumenda non voluptas cupiditate qui?
            Incidunt, ut reiciendis voluptate amet provident debitis numquam tenetur rem fugiat quod deserunt saepe earum assumenda ad, facere laudantium enim autem mollitia vero cum atque animi. Magnam dolorum soluta nobis?
            Omnis dicta aperiam, dolor iure atque consequatur eum cum quisquam autem deleniti voluptatum tempora architecto voluptate reprehenderit hic magnam aspernatur doloribus nesciunt vitae velit, ipsum natus incidunt modi tempore! Eos!  Laborum dolores nulla sed. Aperiam minima cum repellendus fugit nihil et iste iusto ipsam non mollitia obcaecati, sapiente minus voluptates rem magnam numquam sequi suscipit expedita nisi quod placeat molestiae!
            </p>`
    },
    {
        id: 3,
        link: "Section 3",
        title: "Section 3",
        content: `
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Temporibus quae, aliquam hic ut esse non magni sequi dolorem. Ratione fuga voluptas molestiae distinctio illo voluptate aliquid vero natus, illum eaque.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum, cum quaerat facilis excepturi, rem numquam corrupti tempore quas beatae omnis suscipit doloribus aut dignissimos sit assumenda non voluptas cupiditate qui?
            Incidunt, ut reiciendis voluptate amet provident debitis numquam tenetur rem fugiat quod deserunt saepe earum assumenda ad, facere laudantium enim autem mollitia vero cum atque animi. Magnam dolorum soluta nobis?
            Omnis dicta aperiam, dolor iure atque consequatur eum cum quisquam autem deleniti voluptatum tempora architecto voluptate reprehenderit hic magnam aspernatur doloribus nesciunt vitae velit, ipsum natus incidunt modi tempore! Eos!  Laborum dolores nulla sed. Aperiam minima cum repellendus fugit nihil et iste iusto ipsam non mollitia obcaecati, sapiente minus voluptates rem magnam numquam sequi suscipit expedita nisi quod placeat molestiae!
            </p>`
    },
    {
        id: 4,
        link: "Section 4",
        title: "Section 4",
        content: `
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum, cum quaerat facilis excepturi, rem numquam corrupti tempore quas beatae omnis suscipit doloribus aut dignissimos sit assumenda non voluptas cupiditate qui?
            Incidunt, ut reiciendis voluptate amet provident debitis numquam tenetur rem fugiat quod deserunt saepe earum assumenda ad, facere laudantium enim autem mollitia vero cum atque animi. Magnam dolorum soluta nobis?
            Omnis dicta aperiam, dolor iure atque consequatur eum cum quisquam autem deleniti voluptatum tempora architecto voluptate reprehenderit hic magnam aspernatur doloribus nesciunt vitae velit, ipsum natus incidunt modi tempore! Eos!  Laborum dolores nulla sed. Aperiam minima cum repellendus fugit nihil et iste iusto ipsam non mollitia obcaecati, sapiente minus voluptates rem magnam numquam sequi suscipit expedita nisi quod placeat molestiae!
            </p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum, cum quaerat facilis excepturi, rem numquam corrupti tempore quas beatae omnis suscipit doloribus aut dignissimos sit assumenda non voluptas cupiditate qui?
            Incidunt, ut reiciendis voluptate amet provident debitis numquam tenetur rem fugiat quod deserunt saepe earum assumenda ad, facere laudantium enim autem mollitia vero cum atque animi. Magnam dolorum soluta nobis?
            Omnis dicta aperiam, dolor iure atque consequatur eum cum quisquam autem deleniti voluptatum tempora architecto voluptate reprehenderit hic magnam aspernatur doloribus nesciunt vitae velit, ipsum natus incidunt modi tempore! Eos!  Laborum dolores nulla sed. Aperiam minima cum repellendus fugit nihil et iste iusto ipsam non mollitia obcaecati, sapiente minus voluptates rem magnam numquam sequi suscipit expedita nisi quod placeat molestiae!
            </p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum, cum quaerat facilis excepturi, rem numquam corrupti tempore quas beatae omnis suscipit doloribus aut dignissimos sit assumenda non voluptas cupiditate qui?
            Incidunt, ut reiciendis voluptate amet provident debitis numquam tenetur rem fugiat quod deserunt saepe earum assumenda ad, facere laudantium enim autem mollitia vero cum atque animi. Magnam dolorum soluta nobis?
            Omnis dicta aperiam, dolor iure atque consequatur eum cum quisquam autem deleniti voluptatum tempora architecto voluptate reprehenderit hic magnam aspernatur doloribus nesciunt vitae velit, ipsum natus incidunt modi tempore! Eos!  Laborum dolores nulla sed. Aperiam minima cum repellendus fugit nihil et iste iusto ipsam non mollitia obcaecati, sapiente minus voluptates rem magnam numquam sequi suscipit expedita nisi quod placeat molestiae!
            </p>`
    }
]

const sectionList = document.querySelector("#section-list");        // Container for sections
const navbarList = document.querySelector(".navbar-list");          // Container for section links in navbar
const scrollToTopBtn = document.querySelector(".scroll-to-top");    // Scroll to top button


/* INSERT DATA TO DOM */
function addSectionToNavbar(section) {
    // Template
    // <li class="navbar__item"><a href="#" class="navbar__link">Section 2</a></li>

    // Create <li>
    const li = document.createElement("li");
    li.className = "navbar__item"

    // Create <a>
    const a = document.createElement("a");
    a.href = "#" ;
    a.dataset.id = `#panel-${section.id}`;
    a.className = "navbar__link";
    a.textContent = section.link;

    li.appendChild(a);
    navbarList.append(li);
}

function addSectionToSectionList(section) {
    // Unique ID to reference panel
    const sectionUniqueId = `panel-${section.id}`

    // Keep appending existing HTML with new HTML snippet
    // for section list
    sectionList.innerHTML += `
        <section id="${sectionUniqueId}" class="panel">
            <h2 class="panel__title">
                <a href="#" data-id="${sectionUniqueId}" class="panel__toggle">
                   ${section.title}
                </a>
            </h2>
            <div class="panel__body">
                <p>${section.content}</p>
            </div>
        </section>
    `;
}



/* HELPER FUNCTIONS */
function resetNavbarLinks() {
    const navbarLinks = document.querySelectorAll(".navbar__link");

    // Remove active state for any navbar links
    navbarLinks.forEach(function(link) {
        link.classList.remove("navbar__link--active");
    });
}


/* COLLAPSE PANEL EVENT */
function togglePanel(event) {
    event.preventDefault();

    if (event.target.className == "panel__toggle") {
        const panel = document.querySelector("#" + event.target.dataset.id);

        // Remove active state for any navbar links
        resetNavbarLinks();

        // Add/remove class to collapse panel
        panel.classList.toggle("panel--collapse");
    }
}



/* SCROLL TO ANCHOR */
function scrollToPanel(event) {
    event.preventDefault();
    const navbarLink = event.target;
    const sectionPanel = document.querySelector(navbarLink.dataset.id);

    // Remove active state for any navbar links
    resetNavbarLinks();

    // Set active state to current link
    navbarLink.classList.add("navbar__link--active");

    // Expand panel in case it is collapsed
    sectionPanel.classList.remove("panel--collapse");

    /*
    This scrolls just after the element,
    Nice CSS `scroll-margin-top` compliments the offset
    https://developer.mozilla.org/en-US/docs/Web/CSS/scroll-margin-top
    https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView */
    sectionPanel.scrollIntoView({
        behavior: "smooth"
    });
}



/* SCROLL TO TOP */
function toggleScrollToTop() {
    if (window.pageYOffset > 300) {
        scrollToTopBtn.classList.add("scroll-to-top--visible");
    } else {
        scrollToTopBtn.classList.remove("scroll-to-top--visible");
    }
}

function scrollUp() {
    // https://developer.mozilla.org/en-US/docs/Web/API/Window/scroll
    window.scroll({
        top: 0,
        left: 0,
        behavior: "smooth"
    });
}



/* SECTION ACTIVE STATE */
function displayPanelInView(panelList) {
    for (const panel of panelList)  {
        const navbarLink = document.querySelector("a[data-id='#" + panel.id + "']");
        if (panel.getBoundingClientRect().top < 150 && !navbarLink.classList.contains("navbar__link--active")) {
            resetNavbarLinks();
            navbarLink.classList.add("navbar__link--active")
        }
    }
}



/* PAGE LOAD SETUP */
document.addEventListener("DOMContentLoaded", function () {
    for (const section of data) {
        // Add link to navbar
        addSectionToNavbar(section);

        // Add section to section container
        addSectionToSectionList(section)
    }

    // Get the recently added elements
    const navbarLinks = document.querySelectorAll(".navbar__link");
    const panelList = sectionList.querySelectorAll(".panel");

    // Attach window scroll event
    document.addEventListener("scroll", function() {
        // Make scroll btn appear after scrolling
        toggleScrollToTop();

        // Section Active State
        displayPanelInView(panelList);
    });

    // Attach event for each panel with scrollToPanel() functionality
    for (const link of navbarLinks) {
        link.addEventListener("click", scrollToPanel);
    }

    // Attach event to toggle panel (collapse/expand)
    sectionList.addEventListener("click", togglePanel);

    // Attah event to scroll back up to page
    scrollToTopBtn.addEventListener("click", scrollUp);
});




/*
TODO
- readme
- comment functions
- hide navbar when not scrolling


- decide to call it section or panel
- async/ await?
- different on load event?

- bug: click between Section 1 and Section 2 in navbar. Events colliding with each other
*/