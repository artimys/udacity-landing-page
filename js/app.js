const data = [
    {
        id: 1,
        link: "Section 1",
        title: "Section 1",
        content: `
            <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Illo molestiae ratione ipsum necessitatibus rerum, voluptatem obcaecati repellat praesentium ullam ad eveniet omnis voluptates itaque deserunt ducimus aliquam quasi incidunt quibusdam!</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum, cum quaerat facilis excepturi, rem numquam corrupti tempore quas beatae omnis suscipit doloribus aut dignissimos sit assumenda non voluptas cupiditate qui?
            Incidunt, ut reiciendis voluptate amet provident debitis numquam tenetur rem fugiat quod deserunt saepe earum assumenda ad, facere laudantium enim autem mollitia vero cum atque animi. Magnam dolorum soluta nobis?
            Omnis dicta aperiam, dolor iure atque consequatur eum cum quisquam autem deleniti voluptatum tempora architecto voluptate reprehenderit hic magnam aspernatur doloribus nesciunt vitae velit, ipsum natus incidunt modi tempore! Eos!  Laborum dolores nulla sed. Aperiam minima cum repellendus fugit nihil et iste iusto ipsam non mollitia obcaecati, sapiente minus voluptates rem magnam numquam sequi suscipit expedita nisi quod placeat molestiae!
            </p>`
    },
    {
        id: 2,
        link: "Section 2",
        title: "Section 2",
        content: `
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Provident quisquam sunt quis error odio voluptates non porro, veritatis reprehenderit numquam fugiat itaque. Velit libero earum architecto fugiat nemo, unde consequuntur.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum, cum quaerat facilis excepturi, rem numquam corrupti tempore quas beatae omnis suscipit doloribus aut dignissimos sit assumenda non voluptas cupiditate qui?
            Incidunt, ut reiciendis voluptate amet provident debitis numquam tenetur rem fugiat quod deserunt saepe earum assumenda ad, facere laudantium enim autem mollitia vero cum atque animi. Magnam dolorum soluta nobis?
            Omnis dicta aperiam, dolor iure atque consequatur eum cum quisquam autem deleniti voluptatum tempora architecto voluptate reprehenderit hic magnam aspernatur doloribus nesciunt vitae velit, ipsum natus incidunt modi tempore! Eos!  Laborum dolores nulla sed. Aperiam minima cum repellendus fugit nihil et iste iusto ipsam non mollitia obcaecati, sapiente minus voluptates rem magnam numquam sequi suscipit expedita nisi quod placeat molestiae!
            </p>`
    },
    {
        id: 3,
        link: "Section 3",
        title: "Section 3",
        content: `
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Temporibus quae, aliquam hic ut esse non magni sequi dolorem. Ratione fuga voluptas molestiae distinctio illo voluptate aliquid vero natus, illum eaque.</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum, cum quaerat facilis excepturi, rem numquam corrupti tempore quas beatae omnis suscipit doloribus aut dignissimos sit assumenda non voluptas cupiditate qui?
            Incidunt, ut reiciendis voluptate amet provident debitis numquam tenetur rem fugiat quod deserunt saepe earum assumenda ad, facere laudantium enim autem mollitia vero cum atque animi. Magnam dolorum soluta nobis?
            Omnis dicta aperiam, dolor iure atque consequatur eum cum quisquam autem deleniti voluptatum tempora architecto voluptate reprehenderit hic magnam aspernatur doloribus nesciunt vitae velit, ipsum natus incidunt modi tempore! Eos!  Laborum dolores nulla sed. Aperiam minima cum repellendus fugit nihil et iste iusto ipsam non mollitia obcaecati, sapiente minus voluptates rem magnam numquam sequi suscipit expedita nisi quod placeat molestiae!
            </p>`
    },
    {
        id: 4,
        link: "Section 4",
        title: "Section 4",
        content: `
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum, cum quaerat facilis excepturi, rem numquam corrupti tempore quas beatae omnis suscipit doloribus aut dignissimos sit assumenda non voluptas cupiditate qui?
            Incidunt, ut reiciendis voluptate amet provident debitis numquam tenetur rem fugiat quod deserunt saepe earum assumenda ad, facere laudantium enim autem mollitia vero cum atque animi. Magnam dolorum soluta nobis?
            Omnis dicta aperiam, dolor iure atque consequatur eum cum quisquam autem deleniti voluptatum tempora architecto voluptate reprehenderit hic magnam aspernatur doloribus nesciunt vitae velit, ipsum natus incidunt modi tempore! Eos!  Laborum dolores nulla sed. Aperiam minima cum repellendus fugit nihil et iste iusto ipsam non mollitia obcaecati, sapiente minus voluptates rem magnam numquam sequi suscipit expedita nisi quod placeat molestiae!
            </p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum, cum quaerat facilis excepturi, rem numquam corrupti tempore quas beatae omnis suscipit doloribus aut dignissimos sit assumenda non voluptas cupiditate qui?
            Incidunt, ut reiciendis voluptate amet provident debitis numquam tenetur rem fugiat quod deserunt saepe earum assumenda ad, facere laudantium enim autem mollitia vero cum atque animi. Magnam dolorum soluta nobis?
            Omnis dicta aperiam, dolor iure atque consequatur eum cum quisquam autem deleniti voluptatum tempora architecto voluptate reprehenderit hic magnam aspernatur doloribus nesciunt vitae velit, ipsum natus incidunt modi tempore! Eos!  Laborum dolores nulla sed. Aperiam minima cum repellendus fugit nihil et iste iusto ipsam non mollitia obcaecati, sapiente minus voluptates rem magnam numquam sequi suscipit expedita nisi quod placeat molestiae!
            </p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum, cum quaerat facilis excepturi, rem numquam corrupti tempore quas beatae omnis suscipit doloribus aut dignissimos sit assumenda non voluptas cupiditate qui?
            Incidunt, ut reiciendis voluptate amet provident debitis numquam tenetur rem fugiat quod deserunt saepe earum assumenda ad, facere laudantium enim autem mollitia vero cum atque animi. Magnam dolorum soluta nobis?
            Omnis dicta aperiam, dolor iure atque consequatur eum cum quisquam autem deleniti voluptatum tempora architecto voluptate reprehenderit hic magnam aspernatur doloribus nesciunt vitae velit, ipsum natus incidunt modi tempore! Eos!  Laborum dolores nulla sed. Aperiam minima cum repellendus fugit nihil et iste iusto ipsam non mollitia obcaecati, sapiente minus voluptates rem magnam numquam sequi suscipit expedita nisi quod placeat molestiae!
            </p>`
    }
]

// Container for sections
const sectionList = document.querySelector("#section-list");
// Container for section links in navbar
const navbarList = document.querySelector(".navbar-list");
// Scroll to top button
const scrollToTopBtn = document.querySelector(".scroll-to-top");


/* INSERT DATA TO DOM
**********************************************************************/

/**
 * @description Build navigation link to append to navbar
 * @param {object} item represents an object from `data` array
 */
const addSectionToNavbar = item => {
    // Create <li>
    const li = document.createElement("li");
    li.className = "navbar__item"

    // Create <a>
    const a = document.createElement("a");
    a.id = `anchor-${item.id}`;
    a.dataset.panelId = `panel-${item.id}`;
    a.className = "navbar__link";
    a.textContent = item.link;

    li.appendChild(a);
    navbarList.append(li);
};

/**
 * @description Build a section for item content which appends to section list
 * @param {object} item represents an object from `data` array
 */
const addSectionToSectionList = item => {
    // Keep appending existing HTML with new HTML snippet
    sectionList.innerHTML += `
        <section id="panel-${item.id}" data-anchor-id="anchor-${item.id}" class="panel">
            <h2 class="panel__title">
                <a href="#" class="panel__toggle">
                   ${item.title}
                </a>
            </h2>
            <div class="panel__body">
                <p>${item.content}</p>
            </div>
        </section>
    `;
};


/* HELPER FUNCTIONS
**********************************************************************/

/**
 * @description Remove active state from all links in navbar
 */
const resetActiveNavbarLinks = () => {
    const navbarLinks = document.querySelectorAll(".navbar__link");

    // Remove active state for any navbar links
    navbarLinks.forEach(function(link) {
        link.classList.remove("navbar__link--active");
    });
};

/**
 * @description Remove active state from all section panels
 */
const resetActivePanels = () => {
    const panels = sectionList.querySelectorAll(".panel");

    // Remove active state for all panels
    panels.forEach(function(panel) {
        panel.classList.remove("panel--active");
    });
};


/* SCROLL TO TOP
**********************************************************************/

/**
 * @description Display scroll button when scrolling down passed a specific position.
 *              Button will hide when scrolling up passed a specific position
 */
const toggleScrollToTop = () => {
    if (window.scrollY > 300) {
        scrollToTopBtn.classList.add("scroll-to-top--visible");
    } else {
        scrollToTopBtn.classList.remove("scroll-to-top--visible");
    }
};

/**
 * @description Smooth scroll back to top of page
 */
const scrollUp = () => {
    // https://developer.mozilla.org/en-US/docs/Web/API/Window/scroll
    window.scroll({
        top: 0,
        left: 0,
        behavior: "smooth"
    });
};


/* PANEL COMPONENT
**********************************************************************/

/**
 * @description Toggle expanding and collapsing the section panel
 * @param {click event} event
 */
const togglePanel = event => {
    event.preventDefault();

    // event.target should be the anchor in the section panel
    const panelAnchor = event.target;

    if (panelAnchor.className == "panel__toggle") {
        const panel = panelAnchor.parentElement.parentElement;

        // Remove active state for navbar links and panels
        resetActiveNavbarLinks();
        resetActivePanels();

        // Add/remove class to collapse panel
        panel.classList.toggle("panel--collapse");
    }
};

/**
 * @description Smooth scroll to section panel from navbar
 * @param {click event} event click event from a navbar link
 */
const scrollToPanel = event => {
    event.preventDefault();
    const currentNavbarLink = event.target;
    const currentPanel = document.querySelector("#" + currentNavbarLink.dataset.panelId);

    // Remove active state for navbar links and panels
    resetActiveNavbarLinks();
    resetActivePanels();

    // Set active state to current link and panel
    currentNavbarLink.classList.add("navbar__link--active");
    currentPanel.classList.add("panel--active");

    // Expand panel in case it is collapsed
    currentPanel.classList.remove("panel--collapse");

    /*
    This scrolls just after the element,
    Nice CSS `scroll-margin-top` compliments the offset
    https://developer.mozilla.org/en-US/docs/Web/CSS/scroll-margin-top
    https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView */
    currentPanel.scrollIntoView({
        behavior: "smooth"
    });
};

/**
 * @description Set active state to corresponding navbar link when panel in top of viewport
 * @param {NodeList} panelList list of section.panels
 */
const displayPanelInView = panelList => {
    for (const panel of panelList)  {
        const navbarLink = document.querySelector("a#" + panel.dataset.anchorId);
        let top = panel.getBoundingClientRect().top;
        let bot = panel.getBoundingClientRect().bottom + 100;
        let y = window.pageYOffset;

        if (panel.getBoundingClientRect().top < 150 && !navbarLink.classList.contains("navbar__link--active")) {
        // if ( top <= 150 && (bot-150) > 80 ) {
            resetActivePanels();
            resetActiveNavbarLinks();
            panel.classList.add("panel--active");
            navbarLink.classList.add("navbar__link--active");
        }
    }
};








/* PAGE LOAD
**********************************************************************/

document.addEventListener("DOMContentLoaded", () => {
    for (const section of data) {
        // Add link to navbar
        addSectionToNavbar(section);

        // Add section to section container
        addSectionToSectionList(section)
    }

    // Get the recently added elements
    const navbarLinks = document.querySelectorAll(".navbar__link");
    const panelList = sectionList.querySelectorAll(".panel");

    // Attach window scroll event
    document.addEventListener("scroll", function() {
        // Make scroll btn appear after scrolling
        toggleScrollToTop();

        // Section Active State
        displayPanelInView(panelList);
    });

    /* BUG:
       Clicking between Section 1 and Section 2 in navbar.
       Event colliding with displayPanelInView().
    */
    // Attach event for each panel with scrollToPanel() functionality
    for (const link of navbarLinks) {
        link.addEventListener("click", scrollToPanel);
    }

    // Attach event to toggle panel (collapse/expand)
    sectionList.addEventListener("click", togglePanel);

    // Attach event to scroll btn to go back up to page
    scrollToTopBtn.addEventListener("click", scrollUp);
});